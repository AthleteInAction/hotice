<div class="template_container">

	<div class="breadcrumb">
		<a href="/dashboard/#/">Home</a>
		<span class="arrow">&nbsp;&rsaquo;&nbsp;</span>
		<span class="ORANGE">Messages</span>
	</div>

	<div class="info-container">

		<div class="info-head">
			
			<a href="" class="info-item" ng:class="{'selected':tab=='inbox'}" ng:click="tab = 'inbox'">Inbox</a>
			<a href="" class="info-item" ng:class="{'selected':tab=='sent'}" ng:click="tab = 'sent'">Sent</a>
			<a href="" class="info-item" ng:class="{'selected':tab=='compose'}" ng:click="tab = 'compose'">Compose</a>
			<div class="info-item"></div>

		</div>

		<div class="info-body" ng:show="tab=='inbox'">

			<table class="inbox">
				<tr>
					<td class="list">
						<ul class="messages-list">
							<li class="messages-item" ng:repeat="message in messages.inbox" ng:class="{'selected':message.objectId==s.objectId,'unread':$parent.channel.messages.contains('objectId',message.objectId)}">
								<a href="" ng:click="$parent.s = message; setRead(message); setReply(message)">
									<div class="message-author"><span>From:&nbsp;</span>{{message.user.gamertag}}</div>
									<div class="message-preview">{{message.body_short}}</div>
									<div class="message-time">{{displayDate(message.createdAt).sDate}}</div>
								</a>
							</li>
						</ul>
					</td>
					<td class="body">
						
						<div ng:if="s" ng:init="">

							<div class="message-recipient"><span>From:&nbsp;</span>{{s.user.gamertag}}</div>
							<div class="message-time">{{displayDate(s.createdAt).sDate}}</div>
							<div class="message-body" ng-bind-html="s.body_html"></div>

							<!-- <span ng:init="reply.user = $parent.current_user"></span>
							<span ng:init="reply.recipient = s.user"></span> -->
							<textarea class="message-input" id="message-input" placeholder="Reply" ng:model="reply.body"></textarea>

							<a href="" class="btn blue" ng:if="reply.body && !reply.loading" ng:click="sendMessage(reply)">Reply</a>
							<a href="" class="btn blue" ng:if="reply.loading" ng:click="">Sending...</a>

						</div>

						<div class="pre">{{reply}}</div>

					</td>
				</tr>
			</table>

		</div>

		<div class="info-body" ng:show="tab=='sent'" ng:init="messages.getSent()">

			<table class="inbox">
				<tr>
					<td class="list">
						<ul class="messages-list">
							<li class="messages-item" ng:repeat="message in messages.sent" ng:class="{'selected':sentI==$index}">
								<a href="" ng:click="$parent.sentI=$index">
									<div class="message-author"><span>To:&nbsp;</span>{{message.recipient.gamertag}}</div>
									<div class="message-preview">{{message.body_short}}</div>
									<div class="message-time">{{displayDate(message.createdAt).sDate}}</div>
								</a>
							</li>
						</ul>
					</td>
					<td class="body">

						<div ng:if="messages.sent[sentI]">

							<div class="message-recipient"><span>To:&nbsp;</span>{{messages.sent[sentI].recipient.gamertag}}</div>
							<div class="message-time">{{displayDate(messages.sent[sentI].createdAt).sDate}}</div>
							<div class="message-body" ng-bind-html="messages.sent[sentI].body_html"></div>

						</div>

					</td>
				</tr>
			</table>

		</div>

		<div class="info-body" ng:show="tab=='compose'">

			<div class="info-pad">
				
				<div class="message-recipients">
					<div class="message-label" ng:if="composer.recipient">Click user to remove</div>
					<div class="message-recipient" ng:show="composer.recipient">
						<a href="" ng:click="composer.recipient = null">{{composer.recipient.gamertag}}</a>
					</div>
					<div class="CLEAR"></div>
				</div>

				<input type="text" class="message-add" id="message-add" placeholder="Add recipient..." wambl-autocomplete="$parent.users" wambl-display-attr="gamertag" wambl-on-select="composer.recipient = item; selectBody()" wambl-on-click="composer.recipient = item; selectBody()" wambl-select-first="true" wambl-blank-on-select="true" ng:model="message_add" ng:show="!composer.recipient" />

				<textarea class="message-input" id="message-input" placeholder="Message" ng:model="composer.body"></textarea>

				<a href="" class="btn blue" ng:if="composer.body && composer.recipient && !composer.loading" ng:click="sendMessage(composer)">Send</a>
				<a href="" class="btn blue" ng:if="composer.loading" ng:click="">Sending...</a>

			</div>

		</div>

	</div>

</div>